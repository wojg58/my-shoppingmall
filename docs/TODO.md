- [x] Phase 1: 기본 인프라

  - [x] Next.js 프로젝트 셋업 (pnpm, App Router, React 19)
  - [x] Clerk 연동 (로그인/회원가입, 미들웨어 보호)
  - [x] 기본 레이아웃/네비게이션 구성 (`app/layout.tsx`, `components/Navbar.tsx`)
  - [x] Supabase 프로젝트 연결 및 환경변수 세팅 (`.env.local`)
  - [x] DB 스키마 준비: `products`, `cart_items`, `orders`, `order_items` (RLS 비활성화)
  - [x] 마이그레이션 작성/적용 (`supabase/migrations/update_shopping_mall_schema.sql`)
  - [x] 샘플 데이터 20개 삽입 완료

- [ ] Phase 2: 상품 기능

  - [ ] 홈페이지
    - [x] 상품 목록 표시 (전체 상품 또는 제한된 개수)
      - [x] **구현 목표**: 홈페이지에 상품 목록을 표시하여 사용자가 쇼핑을 시작할 수 있도록 함
      - [x] Server Component에서 Supabase로부터 상품 데이터 페칭 (`createPublicSupabaseClient` 사용, is_active=true, 최신순 정렬)
      - [x] 상품 개수 제한 설정 (홈페이지 최대 12개로 설정 완료)
      - [x] 상품 카드 컴포넌트 구현 (`components/product-card.tsx`)
        - [x] 상품 이미지 영역 (Package 아이콘 placeholder 구현 완료)
        - [x] 상품명 표시 (line-clamp-2로 2줄 제한)
        - [x] 가격 표시 (숫자 포맷팅: `formatPrice` 함수로 "89,000원" 형식)
        - [x] 카테고리 뱃지 표시 (한글 라벨 매핑 포함)
        - [x] 재고 상태 표시 (품절/재고부족 뱃지, 재고 개수 표시)
        - [x] 클릭 시 상품 상세 페이지로 이동 (`/products/[id]` - Link 컴포넌트)
      - [x] 상품 목록 그리드 레이아웃 구현 (반응형: 모바일 1열, 태블릿 2열, 데스크톱 3-4열)
      - [x] 로딩 상태 UI 구현 (Suspense를 활용한 스켈레톤 로더 추가 완료)
        - [x] shadcn/ui skeleton 컴포넌트 설치
        - [x] ProductCardSkeleton 컴포넌트 구현
        - [x] ProductsList 컴포넌트 분리 (Server Component)
        - [x] Suspense 적용 및 로딩 폴백 설정
        - [x] Error Boundary 추가 (`app/error.tsx`)
      - [x] 에러 상태 처리 (ErrorState 컴포넌트로 에러 메시지 표시, 환경변수 체크 포함)
      - [x] 빈 상태 처리 (EmptyState 컴포넌트로 상품 없을 때 안내 메시지 표시)
      - [x] 핵심 로직에 로그 추가 (console.group으로 데이터 페칭 성공/실패, 상품 개수, 카테고리별 통계 로깅)
      - [x] Hydration 문제 해결 (ProductCard를 클라이언트 컴포넌트로 분리)
    - [x] 카테고리 기능 (카테고리별 상품 필터링)
      - [x] 카테고리 상수 정의 (`constants/categories.ts`): 카테고리 코드와 한글 라벨 매핑
      - [x] 카테고리 필터 컴포넌트 (`components/category-filter.tsx`): URL 쿼리 파라미터 기반 필터링 버튼 UI
      - [x] 홈페이지에 "전체 상품" 제목 및 카테고리 필터 추가 (`app/page.tsx`)
      - [x] 상품 목록 컴포넌트에 카테고리 필터링 로직 추가 (`components/products-list.tsx`)
      - [x] URL 쿼리 파라미터 사용 (`?category=electronics`)으로 공유/검색 가능 및 브라우저 뒤로가기 지원
      - [x] 서버 사이드 필터링으로 성능 최적화
    - [x] 인기 상품 기능 (인기 상품 섹션 표시)
      - [x] 인기 상품 목록 컴포넌트 생성 (`components/popular-products.tsx`): 최신순 상품 중 8개 표시
      - [x] 홈페이지에 인기 상품 섹션 추가 (`app/page.tsx`): 페이지 헤더 아래 배치
      - [x] "🔥 인기 상품" 제목 추가
      - [x] Suspense를 활용한 로딩 상태 처리 (PopularProductsLoading 컴포넌트)
      - [x] 기존 ProductCard 컴포넌트 재사용
      - [x] 핵심 로직에 로그 추가 (console.group으로 데이터 페칭 성공/실패, 상품 개수, 카테고리별 통계 로깅)
  - [ ] 상품 목록 페이지
    - [ ] **구현 목표**: 전체 상품을 조회하고 필터링/정렬할 수 있는 전용 페이지 제공
    - [x] 페이지 라우트 생성 (`app/products/page.tsx`)
      - [x] Server Component로 구현 (Next.js App Router)
      - [x] URL 쿼리 파라미터 처리 (`category`, `sort`, `page`, `search`)
      - [x] 홈페이지와 동일한 레이아웃 구조 적용 (헤더, 필터, 목록)
    - [x] 페이지네이션 구현
      - [x] URL 쿼리 파라미터 기반 페이지네이션 (`?page=1`, `?page=2`)
      - [x] 한 페이지당 상품 개수 설정 (20개로 설정 완료)
      - [x] 페이지네이션 UI 컴포넌트 생성 (`components/products-pagination.tsx`)
        - [x] 이전/다음 버튼
        - [x] 페이지 번호 표시 (현재 페이지 중심으로 앞뒤 몇 개만 표시)
        - [x] 총 페이지 수 표시
      - [x] Supabase 쿼리에 `range()` 메서드 적용 (offset 기반)
      - [x] 총 상품 개수 조회 (`count()` 옵션 사용)
    - [x] 정렬 기능 (가격, 최신순, 인기순)
      - [x] 정렬 옵션 상수 정의 (`constants/sort-options.ts`): 코드와 한글 라벨 매핑
      - [x] 정렬 UI 컴포넌트 생성 (`components/products-sort.tsx`)
        - [x] 버튼 그룹으로 구현 (카테고리 필터와 동일한 스타일)
        - [x] URL 쿼리 파라미터 기반 (`?sort=price_asc`, `?sort=price_desc`, `?sort=newest`, `?sort=popular`)
      - [x] Supabase 쿼리 정렬 로직 추가 (`order()` 메서드)
        - [x] 가격 오름차순: `order('price', { ascending: true })`
        - [x] 가격 내림차순: `order('price', { ascending: false })`
        - [x] 최신순: `order('created_at', { ascending: false })`
        - [x] 인기순: (임시로 `order('created_at')` 또는 별도 로직 필요 시 추가)
    - [x] 카테고리 필터링
      - [x] 기존 `CategoryFilter` 컴포넌트 재사용
      - [x] URL 쿼리 파라미터를 `/products` 경로로 변경 (`usePathname`으로 현재 경로 자동 감지)
      - [x] 상품 목록 컴포넌트에 카테고리 필터링 로직 적용 (기존 `ProductsList` 로직 재사용)
    - [x] 검색 기능 (선택사항)
      - [x] 검색 UI 컴포넌트 생성 (`components/products-search.tsx`)
        - [x] Input 컴포넌트 사용 (shadcn/ui)
        - [x] 실시간 검색 (debounce 500ms 적용)
        - [x] 검색 버튼 및 Enter 키 지원
        - [x] URL 쿼리 파라미터 기반 (`?search=키워드`)
      - [x] Supabase 쿼리에 `ilike` 적용
        - [x] 상품명(`name`) 및 설명(`description`) 필드 검색 (OR 조건)
      - [x] 검색 결과 없을 때 UI 처리 (검색어, 카테고리별 상황별 메시지)
    - [x] 상품 목록 컴포넌트 확장 (`components/products-list.tsx`)
      - [x] 페이지네이션 파라미터 지원 (`page`, `itemsPerPage`)
      - [x] 정렬 파라미터 지원 (`sort`)
      - [x] 검색 파라미터 지원 (`search`)
      - [x] 총 개수 반환 (페이지네이션을 위해) - `countQuery`로 `totalCount` 조회 및 반환
      - [x] 기존 카테고리 필터링 로직 유지 (`category` 파라미터)
    - [x] 로딩 상태 처리
      - [x] Suspense를 활용한 스켈레톤 로더 적용 (`app/products/page.tsx`)
      - [x] 기존 `ProductCardSkeleton` 컴포넌트 재사용
      - [x] 페이지네이션 개수만큼 스켈레톤 표시 (20개 - `ProductsLoading` 컴포넌트)
    - [x] 에러/빈 상태 처리
      - [x] 에러 상태 컴포넌트 (`ProductsError`) - 환경변수 체크 포함, 홈페이지와 동일한 패턴
      - [x] Error Boundary 추가 (`app/error.tsx`) - 전역 에러 처리
      - [x] 빈 상태 컴포넌트 (검색 결과 없음, 필터 결과 없음 등 상황별 메시지) - `ProductsList` 및 `ProductsListWithPagination`에 구현
    - [x] URL 쿼리 파라미터 관리
      - [x] 여러 파라미터 조합 지원 (`/products?category=electronics&sort=price_asc&page=2&search=키워드`)
        - [x] 모든 컴포넌트에서 다른 파라미터 유지 로직 구현 (CategoryFilter, ProductsSort, ProductsSearch, ProductsPagination)
      - [x] 파라미터 변경 시 페이지 리셋 (검색/정렬/카테고리 변경 시 `page=1`로 리셋)
        - [x] CategoryFilter: 카테고리 변경 시 페이지 리셋
        - [x] ProductsSort: 정렬 변경 시 페이지 리셋
        - [x] ProductsSearch: 검색 변경 시 페이지 리셋
    - [x] 핵심 로직에 로그 추가
      - [x] `console.group`으로 데이터 페칭 시작/종료 로깅 (`ProductsList`, `app/products/page.tsx`)
      - [x] 입력 파라미터 로깅 (category, sort, page, search 등)
      - [x] 페이지네이션 정보 (현재 페이지, 총 페이지, 총 개수, 범위)
      - [x] 정렬/필터/검색 파라미터 로깅 (필터 조건 상세 정보)
      - [x] 성공/실패 여부 및 에러 정보 (에러 발생 시 필터 조건 포함)
      - [x] 카테고리별 통계 로깅
      - [x] UI 컴포넌트 로깅 (CategoryFilter, ProductsSort, ProductsSearch, ProductsPagination)
  - [x] 상품 상세 페이지
    - [x] 상품 정보 표시 (이름, 설명, 가격, 재고) - `app/products/[id]/page.tsx`
    - [x] 카테고리 표시 (한글 라벨 매핑 포함)
    - [x] 장바구니 담기 버튼 (UI만, 기능은 Phase 3에서 구현 예정)
    - [x] 재고 부족 시 알림 표시 (품절/재고부족 뱃지 및 알림 메시지)
    - [x] 로딩 상태 처리 (Suspense + 스켈레톤)
    - [x] 에러 상태 처리 (404 페이지, 환경변수 체크)
    - [x] 핵심 로직에 로그 추가
  - [ ] 어드민 상품 등록은 대시보드에서 수기 관리 (문서화만)

- [ ] Phase 3: 장바구니 & 주문

  - [ ] 장바구니 기능
    - [ ] **구현 목표**: 사용자가 원하는 상품을 장바구니에 담고, 수량을 조절하며, 주문 전 최종 확인할 수 있는 기능 제공
    - [x] Server Actions 생성 (`actions/cart.ts`)
      - [x] `addToCart`: 장바구니에 상품 추가
        - [x] 기존 아이템 존재 시 수량 증가 (UNIQUE 제약 활용)
        - [x] 재고 검증 (주문 수량 ≤ 재고)
        - [x] 로그인 상태 확인 (미로그인 시 에러 처리)
        - [x] 에러 처리 (재고 부족, 로그인 필요 등)
        - [x] 로그 추가 (console.group으로 성공/실패, 수량, 재고 상태 로깅)
      - [x] `updateCartItemQuantity`: 장바구니 아이템 수량 변경
        - [x] 재고 검증 (새 수량 ≤ 재고)
        - [x] 수량 0 이하 방지
        - [x] 권한 검증 (본인 장바구니만 수정 가능)
        - [x] 로그 추가 (수량 변경 전후 값 로깅)
      - [x] `removeFromCart`: 장바구니에서 상품 삭제
        - [x] 권한 검증 (본인 장바구니만 삭제 가능)
        - [x] 로그 추가 (삭제된 상품 정보 로깅)
      - [x] `getCartItems`: 장바구니 조회 (JOIN products)
        - [x] `cart_items`와 `products` 테이블 JOIN
        - [x] 상품명, 가격, 이미지, 재고 등 전체 정보 조회
        - [x] `clerk_id`로 필터링
        - [x] 로그 추가 (조회된 아이템 개수, 총액 로깅)
    - [x] GNB 장바구니 아이콘 추가
      - [x] Navbar 컴포넌트 수정 (`components/Navbar.tsx`)
        - [x] 로그인/회원가입 버튼 왼쪽에 장바구니 아이콘 배치
        - [x] `<Link href="/cart">` 구조로 구현
      - [x] 장바구니 아이콘 컴포넌트 생성 (`components/cart-icon.tsx`)
        - [x] 클라이언트 컴포넌트로 구현
        - [x] ShoppingCart 아이콘 표시 (lucide-react)
        - [x] 장바구니 개수 뱃지 표시 (개수 > 0일 때만)
        - [x] 호버 효과 및 클릭 시 장바구니 페이지로 이동
      - [x] 장바구니 개수 조회 Hook 생성 (`hooks/use-cart-count.ts`)
        - [x] `useClerkSupabaseClient` 사용 (인증된 사용자만)
        - [ ] React Query로 캐싱 및 자동 갱신 (선택사항 - 추후 개선)
        - [x] `cart_items` 테이블에서 `clerk_id`로 개수 집계
        - [x] 로그 추가 (개수 조회 성공/실패 로깅)
    - [x] 장바구니 페이지 구현 (`app/cart/page.tsx`)
      - [x] Server Component로 데이터 페칭
        - [x] `cart_items` + `products` JOIN 조회
        - [x] `clerk_id`로 필터링
        - [x] 총액 계산 (서버 또는 클라이언트)
        - [x] 로딩 상태 처리 (Suspense + 스켈레톤)
        - [x] 에러 상태 처리 (환경변수 체크, 네트워크 에러)
        - [x] 로그 추가 (데이터 페칭 성공/실패, 아이템 개수, 총액 로깅)
      - [x] 장바구니 아이템 컴포넌트 생성 (`components/cart-item.tsx`)
        - [x] 상품 정보 표시
          - [x] 상품 이미지 (Package 아이콘 placeholder)
          - [x] 상품명 (클릭 시 상품 상세 페이지로 이동)
          - [x] 단가 표시 (`formatPrice` 함수 사용)
        - [x] 수량 변경 UI
          - [x] 증가/감소 버튼
          - [x] 수량 입력 필드 (직접 입력 가능)
          - [x] 재고 확인 및 제한
        - [x] 소계 계산 및 표시 (단가 × 수량)
        - [x] 삭제 버튼
          - [x] 확인 다이얼로그 표시 (confirm 사용)
          - [x] 삭제 후 장바구니 목록 갱신 (router.refresh)
      - [x] 빈 장바구니 상태 UI 생성 (`components/empty-cart.tsx`)
        - [x] "장바구니가 비어있습니다" 메시지
        - [x] ShoppingCart 아이콘 표시
        - [x] "쇼핑 계속하기" 버튼 → `/products`로 이동
      - [x] 장바구니 총액 표시 섹션
        - [x] 총 상품 개수 표시
        - [x] 총액 계산 및 표시
        - [x] 가격 포맷팅 (`formatPrice` 함수 사용)
      - [x] 주문하기 버튼
        - [x] 장바구니 하단에 고정 배치
        - [x] "주문하기" 버튼 → `/orders/new`로 이동 (Phase 3-2에서 구현)
        - [x] 비활성화 조건: 장바구니 비어있음, 품절 상품 포함 등
      - [x] 품절 상품 알림 UI
        - [x] 품절 상품 포함 시 알림 메시지 표시
    - [x] 상품 상세 페이지 장바구니 담기 기능
      - [x] "장바구니에 담기" 버튼 기능 연결
        - [x] `ProductQuantitySelector`에서 선택한 수량 가져오기
        - [x] `addToCart` Server Action 호출
        - [x] 로딩 상태 처리 (버튼 비활성화, 스피너 표시)
        - [x] 성공/실패 피드백 표시
      - [x] 장바구니 담기 완료 다이얼로그 생성 (`components/cart-add-dialog.tsx`)
        - [x] 다이얼로그 내용:
          - [x] "장바구니에 담겼습니다" 메시지
          - [x] 담은 상품명과 수량 표시
          - [x] 버튼 2개:
            - [x] "장바구니로 이동" → `/cart`로 이동
            - [x] "계속 쇼핑하기" → 다이얼로그 닫기
        - [x] shadcn/ui Dialog 컴포넌트 사용
      - [x] 재고 검증 및 에러 처리
        - [x] 재고 부족 시 상세 메시지 표시
        - [x] 로그인 상태 확인 (미로그인 시 로그인 모달 유도)
        - [x] 네트워크 에러 처리
      - [x] ProductCartActions 컴포넌트 생성 (`components/product-cart-actions.tsx`)
        - [x] 클라이언트 컴포넌트로 장바구니 담기 기능 통합
        - [x] 수량 선택 및 장바구니 담기 UI 통합
        - [x] GNB 장바구니 아이콘 자동 갱신 (이벤트 기반)
    - [x] 실시간 동기화 및 최적화
      - [ ] React Query 캐싱 전략 설정 (선택사항 - 추후 개선)
        - [ ] `cart-items` 쿼리 키로 캐싱
        - [ ] 장바구니 추가/수정/삭제 시 자동 무효화
        - [ ] 낙관적 업데이트 고려 (선택사항)
      - [x] 장바구니 개수 실시간 업데이트
        - [x] GNB 아이콘 자동 갱신 (이벤트 기반: `cart-updated`)
        - [x] 페이지 전환 없이 즉시 반영
        - [x] 페이지 포커스 시 자동 갱신
      - [x] 성능 최적화
        - [ ] 이미지 lazy loading (이후 이미지 추가 시)
        - [x] 메모이제이션 (총액 계산 등 - Server Component에서 처리)
  - [ ] 주문 프로세스
    - [ ] **구현 목표**: 장바구니의 상품들을 주문으로 변환하고, 배송 정보를 입력받아 주문을 생성하는 기능 제공
    - [ ] 주문 페이지 구현 (`app/orders/new/page.tsx`)
      - [x] Server Component로 장바구니 데이터 페칭
        - [x] `cart_items` + `products` JOIN 조회 (`getCartItems` 사용)
        - [x] `clerk_id`로 필터링
        - [x] 주문 요약 정보 계산 (총액, 총 수량 등)
        - [x] 로딩 상태 처리 (Suspense + 스켈레톤)
        - [x] 에러 상태 처리
        - [x] 로그 추가
        - [x] 장바구니 비어있을 때 장바구니 페이지로 리다이렉트
        - [x] 미로그인 시 로그인 페이지로 리다이렉트
      - [x] 주문 요약 정보 표시 (상품 목록, 수량, 가격, 총액)
        - [x] 주문 요약 컴포넌트 생성 (`components/order-summary.tsx`)
        - [x] 장바구니 아이템 목록 표시 (간소화된 형태)
        - [x] 상품별 소계 및 총액 표시
        - [x] 가격 포맷팅 (`formatPrice` 함수 사용)
        - [x] 총 상품 개수 표시
        - [x] 품절 상품 확인 및 알림
      - [x] 배송지 정보 입력 폼
        - [x] Zod 스키마 작성 (`lib/schemas/order.ts`)
          - [x] 주소 (필수, 최소 5자)
          - [x] 우편번호 (필수, 5자리 숫자 형식)
          - [x] 상세 주소 (선택, 최대 200자)
          - [x] 연락처 (필수, 한국 전화번호 형식 검증)
          - [x] 주문 메모 스키마 (선택, 최대 500자)
          - [x] TypeScript 타입 추론 지원
          - [x] 빈 문자열 처리 (undefined 변환)
        - [x] react-hook-form 적용
          - [x] 폼 상태 관리
          - [x] 유효성 검사 (zodResolver 사용)
          - [x] 에러 메시지 표시
          - [x] 실시간 검증 (onChange 모드)
        - [x] 입력 필드 UI
          - [x] shadcn/ui Input, Label, Textarea 컴포넌트 사용
          - [x] 반응형 레이아웃
          - [x] 배송지 정보 입력 폼 컴포넌트 생성 (`components/shipping-form.tsx`)
          - [x] 주문 폼 래퍼 컴포넌트 생성 (`components/order-form-wrapper.tsx`)
          - [x] 주문 페이지에 폼 통합
      - [x] 주문 메모 입력 기능
        - [x] Textarea 컴포넌트 사용
        - [x] 최대 글자 수 제한 (500자)
        - [x] 선택사항으로 표시
      - [x] 주문 테이블 저장 (`orders`, `order_items`)
        - [x] Server Action 생성 (`actions/order.ts`)
          - [x] `createOrder`: 주문 생성
            - [x] 장바구니 데이터 검증
            - [x] 재고 재확인 (주문 시점 재고 확인)
            - [x] 품절 상품 확인
            - [x] `orders` 테이블에 주문 저장
              - [x] `clerk_id`, `total_amount`, `status='pending'`
              - [x] `shipping_address` (JSONB 형태로 저장)
              - [x] `order_note` 저장
            - [x] `order_items` 테이블에 주문 상품 저장
              - [x] 상품별로 `order_id`, `product_id`, `product_name`, `quantity`, `price` 저장
            - [x] 트랜잭션 처리 (주문 상품 저장 실패 시 주문 롤백)
            - [x] 로그 추가 (주문 생성 성공/실패, 주문 정보 로깅)
            - [x] 캐시 무효화 (revalidatePath)
      - [x] 주문 합계 검증 (장바구니 총액과 일치 여부 확인)
        - [x] 서버에서 장바구니 총액 재계산
        - [x] 주문 총액과 비교
        - [x] 불일치 시 에러 처리
        - [x] 로그 추가
      - [x] 주문 폼 제출 기능 연결
        - [x] OrderFormWrapper에 createOrder 호출 추가
        - [x] 주문 성공 시 리다이렉트 처리 (`/orders/[id]/success`)
        - [x] 에러 처리 및 피드백 표시
      - [x] 주문 성공 후 처리
        - [x] 주문 성공 페이지 구현 (`/orders/[id]/success`)
          - [x] 주문 조회 Server Action 추가 (`getOrder`)
          - [x] 주문 정보 표시 (주문 번호, 총액, 상태, 배송지)
          - [x] 주문 상품 목록 표시
          - [x] 성공 메시지 및 아이콘 표시
          - [x] 다음 액션 버튼 (홈으로, 쇼핑 계속하기)
          - [x] 로딩 상태 처리 (Suspense + 스켈레톤)
          - [x] 에러 상태 처리
          - [x] 로그 추가
        - [x] 주문 성공 페이지로 리다이렉트 (주문 생성 후)
        - [ ] 주문 상세 페이지 구현 (`/orders/[id]`) - 선택사항
        - [ ] 장바구니는 Phase 4에서 결제 완료 후 비우기 (현재는 유지)

- [x] Phase 4: 결제 통합 (Toss Payments v1 테스트 모드)

  - [x] **참고사항**

    - [x] v1 결제창 SDK 사용 (v2가 아닌 이유: v2 결제위젯은 사업자 등록 필요)
    - [x] 테스트 결제만 구현 (DB 스키마 변경 없음)
    - [x] 결제 완료 시 `orders.status = 'confirmed'`만 업데이트
    - [x] 장바구니 비우기 및 재고 감소 포함

  - [x] 1단계: v1 결제창 SDK 전환

    - [x] npm 패키지 설치 (`@tosspayments/payment-sdk`)
    - [x] 기존 v2 코드 수정
      - [x] `lib/tosspayments/client.ts` (v2 → v1 전환)
        - [x] `loadTossPayments`: npm 패키지 우선, 스크립트 폴백
        - [x] `initializeTossPayments`: v1 결제창 초기화 로직
        - [x] v2 위젯 관련 함수 제거 (`createPaymentWidget`)
      - [x] `components/tosspayments-script.tsx` (v2 스크립트 → v1 스크립트 변경)
        - [x] `https://js.tosspayments.com/v1/payment` 로 변경
    - [x] v1 결제창 SDK 스크립트 로드 확인
    - [x] v1 클라이언트 초기화 로직 구현 완료
    - [x] v1 `requestPayment` 메서드 사용법 확인 및 적용

  - [x] 2단계: 장바구니 페이지 결제 버튼 연동 (우선 구현)

    - [x] 장바구니 페이지에서 체크아웃 플로우 구현
      - [x] "주문하기" 버튼 → `/cart/checkout` 페이지로 이동
      - [x] 체크아웃 페이지 레이아웃 구성 (주문 요약 좌측, 배송지 정보 우측)
    - [x] 체크아웃 페이지 구현 (`app/cart/checkout/page.tsx`)
      - [x] Server Component로 장바구니 데이터 페칭
      - [x] `CartCheckoutContent` 컴포넌트 렌더링
      - [x] 로딩/에러 상태 처리
    - [x] 체크아웃 컨텐츠 컴포넌트 생성 (`components/cart-checkout-content.tsx`)
      - [x] 배송지 정보 폼 통합 (`ShippingForm`)
      - [x] 주문 요약 정보 표시 (`OrderSummary`)
      - [x] 그리드 레이아웃 (주문 요약 1/3, 배송지 폼 2/3)
      - [x] 폼 제출 시 결제창 호출 로직
      - [x] 세션 스토리지를 통한 배송지 정보 저장
      - [x] v1 결제창 초기화 및 호출 (`initializeTossPayments`)
      - [x] 결제 정보 구성 (amount, orderId, orderName, customerName, successUrl, failUrl)
      - [x] 임시 주문 ID 생성 (timestamp 기반)
      - [x] 주문명 생성 (상품명 기반)
      - [x] 로딩 및 에러 상태 관리
    - [x] 결제 전 배송지 정보 입력 단계 추가
      - [x] 배송지 정보 입력 폼 (`components/shipping-form.tsx`)
        - [x] Zod 스키마 작성 (`lib/schemas/order.ts`)
          - [x] 받는 사람 이름 (필수, 최소 2자, 최대 50자)
          - [x] 주소 (필수, 최소 5자)
          - [x] 우편번호 (필수, 5자리 숫자 형식)
          - [x] 상세 주소 (선택, 최대 200자)
          - [x] 연락처 (필수, 한국 전화번호 형식 검증)
          - [x] 주문 메모 스키마 (선택, 최대 500자)
          - [x] TypeScript 타입 추론 지원
          - [x] 빈 문자열 처리 (undefined 변환)
        - [x] react-hook-form 적용
          - [x] 폼 상태 관리
          - [x] 유효성 검사 (zodResolver 사용)
          - [x] 에러 메시지 표시
          - [x] 실시간 검증 (onChange 모드)
        - [x] 배송지 정보 입력 UI
          - [x] 받는 사람 이름 필드 (Input 컴포넌트)
          - [x] 주소 필드 (Input 컴포넌트)
          - [x] 우편번호 필드 (Input 컴포넌트)
          - [x] 상세 주소 필드 (Input 컴포넌트, 선택사항)
          - [x] 연락처 필드 (Input 컴포넌트)
          - [x] 주문 메모 필드 (Textarea 컴포넌트, 선택사항)
      - [x] 배송지 정보 입력 후 결제창 열기 플로우
        - [x] 체크아웃 페이지에서 폼 제출
        - [x] 폼 유효성 검사 통과 후 결제창 호출
        - [x] 세션 스토리지를 통한 배송지 정보 전달 (`checkout_{orderId}` 키 사용)
        - [x] 결제 성공 후 세션 스토리지에서 배송지 정보 로드
      - [x] 결제창 호출 시 배송지 정보 활용
        - [x] `customerName` 파라미터에 받는 사람 이름 전달
        - [x] 배송지 정보를 결제 승인 시 주문 저장에 사용
        - [x] `confirmPaymentAndCreateOrder`에 배송지 정보 파라미터 추가
        - [x] 주문 생성 시 `shipping_address` 및 `order_note` 저장
    - [x] 결제 성공/실패 페이지 생성
      - [x] `/cart/payment/success` 페이지 생성
      - [x] `/cart/payment/fail` 페이지 생성
      - [x] URL 파라미터 처리 (paymentKey, orderId, amount, code, message)

  - [ ] 2-2단계: 주문 페이지 결제창 연동 (추후 구현)

    - [ ] 주문 생성 후 결제창 열기 플로우 수정
      - [ ] `OrderPaymentFlow` 컴포넌트 수정 (v1 결제창 호출)
      - [ ] 주문 생성 완료 후 결제창 자동 호출
      - [ ] 결제 정보 설정 (amount, orderId, orderName, successUrl, failUrl 등)
    - [ ] 결제창 호출 파라미터 구성
      - [ ] 결제 수단: "카드" (테스트용)
      - [ ] 결제 금액: 주문 총액
      - [ ] 주문 ID: 생성된 orderId
      - [ ] 주문명: 상품명 생성 (예: "상품명 외 N건")
      - [ ] 성공 URL: `/orders/[id]/payment/success`
      - [ ] 실패 URL: `/orders/[id]/payment/fail`

  - [x] 3단계: 결제 성공/실패 콜백 처리

    - [x] 결제 성공 페이지 (`/cart/payment/success`)
      - [x] URL 파라미터에서 `paymentKey`, `orderId`, `amount` 추출
      - [x] 결제 금액 검증 (장바구니 총액과 일치 확인)
      - [x] 결제 승인 Server Action 호출 (`confirmPaymentAndCreateOrder`)
      - [x] 성공 메시지 및 주문 정보 표시
      - [x] 배송지 정보 세션 스토리지에서 로드 및 전달
      - [x] 주문 저장 완료 후 세션 스토리지 정리
    - [x] 결제 실패 페이지 (`/cart/payment/fail`)
      - [x] URL 파라미터에서 `code`, `message` 추출
      - [x] 실패 메시지 표시 (에러 코드 매핑 포함)
      - [x] 재시도 옵션 제공
    - [ ] 주문 페이지 결제창 연동 (`/orders/[id]/payment/success`, `/orders/[id]/payment/fail`) - 추후 구현 (현재는 장바구니 결제만 구현)

  - [x] 4단계: 결제 승인 및 주문 저장 구현

    - [x] Server Action 생성 (`actions/payment.ts`)
      - [x] `confirmPaymentAndCreateOrder`: 결제 승인 및 주문 저장 처리
        - [x] 인증 확인 (Clerk userId)
        - [x] 입력 데이터 검증 (paymentKey, orderId, amount)
        - [x] 장바구니 데이터 조회 (`getCartItems`)
        - [x] 결제 금액 검증 (장바구니 총액과 일치 확인)
        - [x] 재고 및 품절 확인
        - [x] Toss Payments 결제 승인 API 호출
          - [x] API 엔드포인트: `POST /v1/payments/confirm`
          - [x] 인증: Basic Auth (secretKey: base64)
          - [x] 요청 본문: `{ paymentKey, orderId, amount }`
        - [x] 결제 승인 성공 시 주문 생성
          - [x] `orders` 테이블에 주문 저장 (status='confirmed')
            - [x] `clerk_id`, `total_amount`, `status` 저장
            - [x] `shipping_address` JSONB 필드에 배송지 정보 저장
            - [x] `order_note` 필드에 주문 메모 저장 (선택사항)
          - [x] `order_items` 테이블에 주문 상품 저장
            - [x] `order_id`, `product_id`, `product_name`, `quantity`, `price` 저장
          - [x] 트랜잭션 처리 (주문 상품 저장 실패 시 주문 롤백)
        - [x] 로그 추가 (승인 성공/실패, 결제 정보)
        - [x] 캐시 무효화 (revalidatePath)
        - [x] 에러 처리 (네트워크 에러, API 에러 등)
    - [x] 결제 성공 페이지에서 결제 승인 및 주문 저장 호출
      - [x] `/cart/payment/success` 페이지 구현 (`app/cart/payment/success/page.tsx`)
        - [x] URL 파라미터에서 결제 정보 추출 (`paymentKey`, `orderId`, `amount`)
        - [x] 세션 스토리지에서 배송지 정보 로드 (`checkout_{orderId}`)
        - [x] 결제 승인 및 주문 저장 Server Action 호출 (`confirmPaymentAndCreateOrder`)
        - [x] 로딩 상태 처리 (처리 중 표시)
        - [x] 에러 상태 처리 (에러 메시지 및 재시도 옵션)
        - [x] 성공 상태 표시 (결제 완료 메시지, 주문 번호, 결제 금액)
        - [x] 주문 저장 완료 후 세션 스토리지 정리
        - [x] 다음 액션 버튼 (홈으로, 쇼핑 계속하기)

  - [x] 5단계: 결제 완료 후 처리

    - [x] 결제 승인 성공 후 자동 처리
      - [x] 장바구니 비우기 (`cart_items` 테이블에서 해당 사용자 데이터 삭제)
        - [x] `clearCart` Server Action 생성 (`actions/cart.ts`)
        - [x] `clerk_id`로 필터링하여 모든 장바구니 아이템 삭제
        - [x] 삭제 전 아이템 개수 확인 및 로깅
      - [x] 상품 재고 감소 처리 (`products.stock_quantity` 업데이트)
        - [x] 저장된 `order_items`에서 주문 상품 목록 조회
        - [x] 각 상품별로 현재 재고 조회
        - [x] 재고 감소 계산 (`stock_quantity -= quantity`)
        - [x] 재고가 0 미만으로 내려가지 않도록 검증 (재고 부족 시 경고 로그만)
        - [x] `products` 테이블 업데이트 (`update` 쿼리)
        - [x] 재고 감소 실패 시 경고 로그 (주문은 완료 상태 유지)
        - [x] 각 상품별 재고 감소 결과 로깅
      - [x] 트랜잭션 처리
        - [x] 주문 저장 → 주문 상품 저장 → 재고 감소 → 장바구니 비우기 순서로 처리
        - [x] 각 단계별 에러 처리 및 로깅
        - [x] 주문은 완료 상태로 유지 (재고/장바구니 처리 실패해도 주문은 성공)
    - [x] 결제 완료 페이지 개선
      - [x] 결제 승인 완료 상태 표시 ✅ 이미 구현됨
      - [x] 주문 저장 완료 메시지 표시
      - [x] 장바구니 비우기 및 재고 감소는 백그라운드에서 자동 처리 (사용자에게 명시적 표시하지 않음)

  - [x] 6단계: 환경변수 및 설정
    - [x] v1 환경변수 확인
      - [x] `NEXT_PUBLIC_TOSS_CLIENT_KEY` (v1 API 개별 연동 키)
      - [x] `TOSS_SECRET_KEY` (v1 시크릿 키)
    - [x] 테스트 키 발급 확인
      - [x] 토스페이먼츠 개발자센터에서 v1 테스트 키 확인 방법 문서화 (README.md, AGENTS.md)
      - [x] 환경변수 설정 가이드 제공

- [ ] Phase 5: 마이페이지

  - [ ] 마이페이지 기본 구조
    - [ ] 마이페이지 라우트 생성
    - [ ] 사용자 정보 표시 (Clerk 연동)
  - [ ] 주문 내역 조회
    - [ ] 주문 목록 조회 (사용자별 `orders` 테이블 필터링)
    - [ ] 주문 상태별 필터링 (pending, confirmed, shipped, delivered, cancelled)
    - [ ] 주문 목록 페이지네이션
  - [ ] 주문 상세 보기
    - [ ] 주문 상세 정보 표시 (주문 번호, 날짜, 총액, 상태)
    - [ ] 주문 상품 목록 표시 (`order_items` 테이블 조회)
    - [ ] 배송지 정보 표시
    - [ ] 주문 취소 기능 (status = 'pending'일 때만 가능)

- [ ] Phase 6: 테스트 & 배포

  - [ ] 전체 사용자 플로우 E2E 점검
    - [ ] 회원가입 → 로그인 → 상품 조회 → 장바구니 추가 → 주문 → 결제 → 주문 내역 확인
  - [ ] 주요 버그 수정 및 예외처리 강화
    - [ ] 재고 부족 시 주문 방지
    - [ ] 잘못된 입력값 검증
    - [ ] 네트워크 에러 처리
    - [ ] 결제 실패 시 롤백 처리
  - [ ] Vercel 배포 설정
    - [ ] 프로젝트 빌드 확인
    - [ ] 환경변수 구성 (Clerk, Supabase, Toss Payments)
    - [ ] 배포 및 동작 확인

- [ ] 공통 작업 & 문서화

  - [ ] 오류/로딩/비어있는 상태 UI 정비
    - [ ] 로딩 스피너 컴포넌트
    - [ ] 에러 메시지 표시
    - [ ] 빈 상태 UI (장바구니 비어있음, 주문 내역 없음 등)
  - [ ] 타입 안전성 강화
    - [ ] Zod 스키마 작성 (주문 정보, 배송지 정보 등)
    - [ ] react-hook-form 적용 (주문 폼, 배송지 입력 등)
    - [ ] TypeScript 타입 정의 완성
  - [ ] README/PRD 반영 및 운영 가이드 업데이트
    - [ ] 프로젝트 설치 및 실행 방법
    - [ ] 환경변수 설정 가이드
    - [ ] Supabase 대시보드에서 상품 등록 방법
    - [ ] 테스트 결제 방법 안내
  - [ ] 접근성/반응형/다크모드 점검
    - [ ] 모바일 반응형 디자인 확인
    - [ ] 키보드 네비게이션 지원
    - [ ] 스크린 리더 호환성 확인
    - [ ] 다크모드 지원 (선택사항)
